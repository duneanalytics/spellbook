version: 2

sources: 
  - name: balancer_ethereum
    description: "Ethereum decoded tables related to Balancer contracts"
    freshness:
      warn_after: { count: 12, period: hour }
      error_after: { count: 24, period: hour }
    tables:
      - name: veBAL_call_create_lock
        loaded_at_field: call_block_time
        description: "Function to create a veBAL lock"
        columns:
          - &_unlock_time
            name: _unlock_time
            description: "Epoch time when tokens unlock; this is the user's request, but the actual unlock time will be rounded down to a Thursday"
          - &value
            name: value
            description: "Amount to deposit"
            # tests: # TODO
            #   - gt_zero
      - name: veBAL_evt_Deposit
        loaded_at_field: evt_block_time
        description: "Emitted when user deposits tokens in their lock or extends its unlock time"
        columns:
          - &locktime
            name: locktime
            description: "Epoch time when tokens unlock"
          - &provider
            name: provider
            description: "The wallet address of the lock's owner"
          - &ts
            name: ts
            description: "Block timestamp"
          - &type
            name: type
            tests:
              - accepted_values:
                  values: [0, 1, 2, 3]
            description: >
              DEPOSIT_FOR_TYPE: 0
              CREATE_LOCK_TYPE: 1
              INCREASE_LOCK_AMOUNT: 2
              INCREASE_UNLOCK_TIME: 3
          - &value
            name: value
            description: "Amount of base tokens added to the lock"
      - name: veBAL_evt_Withdraw
        loaded_at_field: evt_block_time
        description: "Emitted when user withdraws tokens from their lock"
        columns:
          - &provider
            name: provider
            description: "The wallet address of the lock's owner"
          - &value
            name: value
            description: "Amount of base tokens withdrawn from the lock"
          - &ts
            name: ts
            description: "Block timestamp"