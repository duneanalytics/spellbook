version: 2

sources:
  - name: optimism_ethereum
    description: "Optimism decoded tables related to bridges and sequencer"
    freshness:
      warn_after: { count: 12, period: hour }
    tables:
      - name: L1ERC721Bridge_evt_ERC721BridgeInitiated
        loaded_at_field: evt_block_time
        description: "Optimism NFT bridge transactions initiated from L1 to L2"
        columns:
          - &contract_address
            name: contract_address
          - &evt_tx_hash
            name: evt_tx_hash
            description: "Primary key of the transaction"
          - &evt_index
            name: evt_index
            description: "Index value of the transaction"
          - &evt_block_time
            name: evt_block_time
            description: "Timestamp for block event time in UTC"
          - &evt_block_number
            name: evt_block_number
            description: "Block number which processed the unique transaction hash"
          - name: extraData
          - &from
            name: from
            description: "Transaction initiated from address"
          - name: localToken
            description: "NFT token address on Ethereum"
          - name: remoteToken
            description: "NFT token address on Optimism"
          - &to
            name: to
            description: "Transaction to address"
          - &tokenId
            name: tokenId
            description: "NFT token id"

      - name: L1StandardBridge_evt_ERC20DepositInitiated
        loaded_at_field: evt_block_time
        description: "Optimism ERC20 bridge transactions initiated from L1 to L2"

      - name: OVM_L1StandardBridge_evt_ERC20DepositInitiated
        loaded_at_field: evt_block_time
        description: "Optimism ERC20 bridge transactions initiated from L1 to L2"

  - name: ovm_optimism
    description: "Optimism decoded tables related to bridges and sequencer on optimism"
    freshness:
      warn_after: { count: 12, period: hour }
    tables:
      - name: L2ERC721Bridge_evt_ERC721BridgeFinalized
        loaded_at_field: evt_block_time
        description: "Optimism NFT bridge transactions finalized on L2"

  - name: tokens_optimism_transfers_base
    meta:
      blockchain: optimism
      sector: tokens
      contributors: aalan3
    config:
      tags: ['tokens','transfers', 'optimism']
    description: >
      Token transfers
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_number
            - tx_index
            - evt_index
            - trace_address
    columns:
      - name: blockchain
        description: "The blockchain of the transfers"
      - name: block_datetime
        description: "The date of the block"
      - name: block_number
        description: "The block number"
      - name: tx_hash
        description: "The transaction hash"
      - name: tx_index
        description: "The transaction index"
      - name: tx_from
        description: "The transaction sender"
      - name: tx_to
        description: "The transaction receiver"
      - name: evt_index
        description: "The log event index of the transfer if any"
      - name: trace_address
        description: "The trace address of the transfer if any"
      - name: token_standard
        description: "The token standard of the transfer"
      - name: contract_address
        description: "The contract address of the transfer"
      - name: to
        description: "The receiver of the transfer"
      - name: from
        description: "The sender of the transfer"
      - name: amount_raw
        description: "The raw amount of the transfer"

  - name: tokens_optimism_transfers
    meta:
      blockchain: optimism
      sector: tokens
      contributors: aalan3
    config:
      tags: ['tokens','transfers', 'optimism']
    description: >
      Token transfers
    columns:
      - name: blockchain
        description: "The blockchain of the transfers"
      - name: block_datetime
        description: "The date of the block"
      - name: block_number
        description: "The block number"
      - name: tx_hash
        description: "The transaction hash"
      - name: tx_index
        description: "The transaction index"
      - name: tx_from
        description: "The transaction sender"
      - name: tx_to
        description: "The transaction receiver"
      - name: evt_index
        description: "The log event index of the transfer if any"
      - name: trace_address
        description: "The trace address of the transfer if any"
      - name: token_standard
        description: "The token standard of the transfer"
      - name: contract_address
        description: "The contract address of the transfer"
      - name: to
        description: "The receiver of the transfer"
      - name: from
        description: "The sender of the transfer"
      - name: amount_raw
        description: "The raw amount of the transfer"
      - name: amount
        description: "The formatted amount of the transfer"
      - name: usd_price
        description: "The USD price used to calculate the amount_usd"
      - name: amount_usd
        description: "The USD amount of the transfer"