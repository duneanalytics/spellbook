version: 2

models:
  - name: unidex_optimism_trades
    meta:
      blockchain: optimism
      sector: dex
      project: unidex
      contributors: ARDev097
    config:
      tags: ['optimism','trades', 'unidex','dex']
    description: >
        unidex dex trades on optimism
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - blockchain
            - project
            - version
            - tx_hash
            - evt_index 
      - check_dex_aggregator_seed:
          blockchain: optimism
          project: unidex
          version: 1
    columns:
      - &blockchain
        name: blockchain
        description: "Blockchain on which the project is deployed"
      - &project 
        name: project
        description: "The underlying protocol/project where the swap took place"  
      - &version
        name: version
        description: "The version of the protocol/project"
      - &block_month
        name: block_month
        description: "Month of the transaction"
      - &block_date
        name: block_date
        description: "Date of the transaction"
      - &block_time
        name: block_time
        description: "Time of the transaction"
      - &token_bought_symbol
        name: token_bought_symbol
        description: "Token symbol for token bought in the transaction"
      - &token_sold_symbol
        name: token_sold_symbol
        description: "Token symbol for token sold in the transaction"
      - &token_pair
        name: token_pair
        description: "Token symbol pair for each token involved in the transaction"
      - &token_bought_amount
        name: token_bought_amount
        description: "Value of the token bought at time of execution in the original currency"
      - &token_sold_amount
        name: token_sold_amount
        description: "Value of the token sold at time of execution in the original currency"
      - &token_bought_amount_raw
        name: token_bought_amount_raw
        description: "Raw value of the token bought at time of execution in the original currency"
      - &token_sold_amount_raw
        name: token_sold_amount_raw
        description: "Raw value of the token sold at time of execution in the original currency"
      - &amount_usd
        name: amount_usd
        description: "USD value of the trade at time of execution"
      - &token_bought_address
        name: token_bought_address
        description: "Contract address of the token bought"
      - &token_sold_address
        name: token_sold_address
        description: "Contract address of the token sold"
      - &taker
        name: taker
        description: "Address of trader who purchased a token"
      - &maker
        name: maker
        description: "Address of trader who sold a token"
      - &project_contract_address
        name: project_contract_address
        description: "Project contract address which executed the trade on the blockchain"
      - &tx_hash
        name: tx_hash
        description: "The hash of the transaction"
      - &tx_from
        name: tx_from
        description: "The address that originated the transaction; based on the optimism.transactions table"
      - &tx_to
        name: tx_to
        description: "The address receiving the transaction; based on the optimism.transactions table"
      - &evt_index
        name: evt_index
        description: "Event index number"
      - &trace_address
        name: trace_address
        description: ""
  
  - name: unidex_v1_optimism_perpetual_trades
    meta:
      blockchain: optimism
      sector: perpetual
      project: unidex_v1
      contributors: ARDev097
    config:
      tags: ['optimism', 'unidex', 'unidex_v1', 'perpetuals', 'perps']
    description: >
      Unidex_v1 perpetuals trades on Optimism
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - blockchain
            - project
            - version
            - tx_hash
            - evt_index
    columns:
      - *blockchain
      - *block_date
      - *block_time
      - &virtual_asset
        name: virtual_asset
        description: "How the protocol represents the underlying asset"
      - &underlying_asset
        name: underlying_asset
        description: "The real underlying asset that is represented in the swap"
      - &market
        name: market
        description: "The futures market involved in the transaction"
      - &market_address
        name: market_address
        description: "Contract address of the market"
        tests:
          - perpetual_trades_market_address:
              perpetual_trades_seed: ref('perpetual_trades_seed')
      - &volume_usd
        name: volume_usd
        description: "The size of the position taken for the swap in USD; already in absolute value and decimal normalized"
      - &fee_usd
        name: fee_usd
        description: "The fees charged to the user for the swap in USD"
      - &margin_usd
        name: margin_usd
        description: "The amount of collateral/margin used in a trade in USD"
      - &trade
        name: trade
        description: "Indicates the trade's direction whether a short, long, of if a position is being closed"
      - *project
      - *version
      - &frontend
        name: frontend
        description: "The frontend protocol/project where the specific swap was executed; built on top of the 'project' and defaults to the 'project' if no other frontend is specified"
      - &trader
        name: trader
        description: "The address which made the swap in the protocol"
      - &volume_raw
        name: volume_raw
        description: "The size of the position in raw form"
      - *tx_hash
      - *tx_from
      - *tx_to
      - *evt_index
      - *block_month
  
  - name: unidex_v2_optimism_perpetual_trades
    meta:
      blockchain: optimism
      sector: perpetual
      project: unidex_v2
      contributors: ARDev097
    config:
      tags: ['optimism', 'unidex', 'unidex_v2', 'perpetuals', 'perps']
    description: >
      Unidex_v2 perpetuals trades on Optimism
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - blockchain
            - project
            - version
            - tx_hash
            - evt_index
    columns:
      - *blockchain
      - *block_time
      - *virtual_asset
      - *underlying_asset
      - *market
      - *market_address
      - *volume_usd
      - *fee_usd
      - *margin_usd
      - *trade
      - *project
      - *version
      - *frontend
      - *trader
      - *volume_raw
      - *tx_hash
      - *tx_from
      - *tx_to
      - *evt_index
      - *block_month

  - name: unidex_v3_optimism_perpetual_trades
    meta:
      blockchain: optimism
      sector: perpetual
      project: unidex_v3
      contributors: ARDev097
    config:
      tags: ['optimism', 'unidex', 'unidex_v3', 'perpetuals', 'perps']
    description: >
      Unidex_v3 perpetuals trades on Optimism
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - blockchain
            - project
            - version
            - tx_hash
            - evt_index
    columns:
      - *blockchain
      - *block_time
      - *virtual_asset
      - *underlying_asset
      - *market
      - *market_address
      - *volume_usd
      - *fee_usd
      - *margin_usd
      - *trade
      - *project
      - *version
      - *frontend
      - *trader
      - *volume_raw
      - *tx_hash
      - *tx_from
      - *tx_to
      - *evt_index
      - *block_month
  
  - name: unidex_optimism_perpetual_trades
    meta:
      blockchain: optimism
      sector: perpetual
      contributors: ARDev097
    config:
      tags: ['optimism', 'perpetuals', 'perps', 'unidex']
    description: >
      Perpetual swaps/trades table on Unidex Optimism
    columns:
      - *blockchain
      - *block_time
      - *virtual_asset
      - *underlying_asset
      - *market
      - name: market_address # since object is a view, avoid test repeat with '*' usage
        description: "Contract address of the market"
      - *volume_usd
      - *fee_usd
      - *margin_usd
      - *trade
      - *project
      - *version
      - *frontend
      - *trader
      - *volume_raw
      - *tx_hash
      - *tx_from
      - *tx_to
      - *evt_index
      - *block_month
