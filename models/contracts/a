{{  config(
        tags = ['dunesql'], 
        schema = 'contracts',
        alias = alias('all'),
        file_format = 'delta',
        materialized = 'incremental',
        incremental_strategy = 'merge',
        unique_key = ['blockchain', 'abi_id', 'address', 'created_at']
    )
}}


{% set models = [
    source('arbitrum', 'contracts')
    , source('avalanche_c', 'contracts')
    , source('base', 'contracts')
    , source('bnb', 'contracts')
    , source('ethereum', 'contracts')
    , source('fantom', 'contracts')
    , source('gnosis', 'contracts')
    , source('optimism', 'contracts')
    , source('polygon', 'contracts')
    , source('arbitrum', 'contracts')
] %}

SELECT 
    'arbitrum' AS blockchain
    , abi_id
    , abi
    , CAST(address AS VARCHAR) AS address
    , CAST("from" AS VARCHAR) AS "from"
    , CAST(code AS VARCHAR) AS code
    , name
    , namespace
    , dynamic
    , base
    , factory
    , detection_source
    , created_at 
FROM {{ source('arbitrum', 'contracts') }}
{% if is_incremental() %}
WHERE created_at >= now() - interval '7' day
{% endif %}
