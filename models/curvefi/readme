# Curvefi Spellbook Models 

Welcome to Curve! Here's a short getting started guide for navigating the protocol, and the model files. 

The protocol docs can be found [here](https://resources.curve.fi/). Each pool has a pool, token, and sometimes gauge contracts. The pool and token are combined into one contract for v1 pools, but have become two seperate contracts (on deployment) for v2.

We haven't included fees in these models yet, but the fees are dynamic and you can read about them at the [end of the whitepaper](https://classic.curve.fi/files/crypto-pools-paper.pdf) or in [this overview article](https://nagaking.substack.com/p/deep-dive-curve-v2-parameters).

The main events are `TokenExchange` and `TokenExchangeUnderlying`, which swap through an array of coin addresses (you can input different indexes starting from 0 in this [read contract link](https://etherscan.io/address/0xbebc44782c7db0a1a60cb6fe97d0b483032ff1c7#readContract) to get a sense of this). So the events have a `bought_id` and `sold_id` that corresponds to this coins index (you'll see for factory trades we usually just get the coin address at the index for the `coins` column).

There are a few pool types you need to know: 
1. Base Pools (v1): these are deployed one by one, and not from a factory. These are defined in the `curvefi_ethereum_pool_details.sql` model. Here's the most popular base pool, [3pool](https://curve.fi/#/ethereum/pools/3pool/deposit), you can see the tokens (coins) involved and other high level stats. These need to be refactored to the methods we use for normal and underlying exchanges in the below pool types (added in PR #2550).
2. Factory Pools (v1 plain): nothing special here, you set a number of tokens (coins) that can be swapped. These are defined in the `curvefi_ethereum_view_pools.sql` model.
3. Factory Pools (v1 meta): this one is the most confusing. You have two tokens, one normal ERC20 like USDD and the other is the base pool that you want to swap into. So [this pool](https://curve.fi/#/ethereum/pools/factory-v2-116/deposit) allows you to swap USDD into the token contract of the 3pool if you do a normal `TokenExchange`. However, you can also swap directly from USDD to USDT with `TokenExchangeUnderlying`. This means you're now swapping through an `undercoins` index, which we've constructed in the `curvefi_ethereum_view_pools.sql` model. You'll see that a CASE WHEN is used for the trades logic of meta pools.
4. Factory Pools (v2): nothing special here, just a normal exchange. Also defined in the `curvefi_ethereum_view_pools.sql` model.

Hope you've found this helpful! If you're looking to contribute to this spell and you get lost, feel free to [reach out to me](https://twitter.com/andrewhong5297) with questions.