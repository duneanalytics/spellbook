version: 2

models:

  - name: account_abstraction_erc4337_zora_v0_5_userops_basics
    meta:
      blockchain: zora
      sector: erc4337
      project: erc4337
      contributors: yourname
    config:
      tags: ["zora", "erc4337", "account", "abstraction", "entrypoint"]
    description: "erc4337 v0.5 user operations on Zora"
    columns:
      - &blockchain
        name: blockchain
        description: "blockchain which EntryPoint was deployed"
      - &version
        name: version
        description: "version of the EntryPoint contract"
      - &block_month
        name: block_month
        description: "UTC event block date of each User Operation"
      - &block_time
        name: block_time
        description: "UTC event block time of each User Operation"
      - &entrypoint_contract
        name: entrypoint_contract
        description: "the contract address of the EntryPoint"
      - &tx_hash
        name: tx_hash
        description: "Unique transaction hash value tied to each transaction on the User Operation"
      - &sender
        name: sender
        description: "the sender (AA wallet address) that submitted the user operation"
      - &userop_hash
        name: userop_hash
        description: "Unique user operation hash"
      - &success
        name: success
        description: "whether the user operation is successfully executed"
      - &paymaster
        name: paymaster
        description: "the address that pays for the user operation gas fees on behalf of the user"
      - &op_fee
        name: op_fee
        description: "The gas paid by sender or paymaster, depending on the chain gas setting"
      - &beneficiary
        name: beneficiary
        description: "the address where the bundler setting for the user operation pays for their gas fee"

  - name: account_abstraction_erc4337_zora_v0_6_userops_basics
    meta:
      blockchain: zora
      sector: erc4337
      project: erc4337
      contributors: yourname
    config:
      tags: ["zora", "erc4337", "account", "abstraction", "entrypoint"]
    description: "erc4337 v0.6 user operations on Zora"
    columns:
      - *blockchain
      - *version
      - *block_month
      - *block_time
      - *entrypoint_contract
      - *tx_hash
      - *sender
      - *userop_hash
      - *success
      - *paymaster
      - *op_fee
      - *beneficiary

  - name: account_abstraction_erc4337_zora_userops
    meta:
      blockchain: zora
      sector: erc4337
      project: erc4337
      contributors: yourname
    config:
      tags: ["zora", "erc4337", "account", "abstraction", "entrypoint"]
    description: "erc4337 user operations on Zora"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - userop_hash
            - tx_hash
      - check_seed:
          seed_file: ref('account_abstraction_erc4337_userops_seed')
          filter:
            blockchain: zora
            version: v0.5
          match_columns:
            - userop_hash
            - tx_hash
          check_columns:
            - paymaster
            - bundler
      - check_seed:
          seed_file: ref('account_abstraction_erc4337_userops_seed')
          filter:
            blockchain: zora
            version: v0.6
          match_columns:
            - userop_hash
            - tx_hash
          check_columns:
            - paymaster
            - bundler
    columns:
      - *blockchain
      - *version
      - *block_month
      - *block_time
      - *entrypoint_contract
      - *tx_hash
      - *sender
      - *userop_hash
      - *success
      - *paymaster
      - *op_fee
      - &op_fee_usd
        name: op_fee_usd
        description: "The user operation gas (in USD) paid by sender or paymaster"
      - &bundler
        name: bundler
        description: "Address that bundles UserOps and submits those UserOps to the final on-chain by sending an EOA transaction"
      - &tx_to
        name: tx_to
        description: "Address where the bundler sends the transaction"
      - &gas_symbol
        name: gas_symbol
        description: "The gas symbol paid for the transaction"
      - &tx_fee
        name: tx_fee
        description: "The bundler paid gas value for the transaction"
      - &tx_fee_usd
        name: tx_fee_usd
        description: "The bundler paid gas (in USD) value for the transaction"
      - *beneficiary

  - name: account_abstraction_erc4337_zora_v0_5_account_deployed
    meta:
      blockchain: zora
      sector: erc4337
      project: erc4337
      contributors: yourname
    config:
      tags: ["zora", "erc4337", "account", "abstraction", "entrypoint"]
    description: "erc4337 v0.5 account deployed on Zora"
    columns:
      - *blockchain
      - *version
      - *block_time
      - *block_month
      - *userop_hash
      - *entrypoint_contract
      - *tx_hash
      - *sender
      - *paymaster
      - &factory
        name: factory
        description: "Who can create a new AA Wallet. It's a smart contract address"

  - name: account_abstraction_erc4337_zora_v0_6_account_deployed
    meta:
      blockchain: zora
      sector: erc4337
      project: erc4337
      contributors: yourname
    config:
      tags: ["zora", "erc4337", "account", "abstraction", "entrypoint"]
    description: "erc4337 v0.6 account deployed on Zora"
    columns:
      - *blockchain
      - *version
      - *block_time
      - *block_month
      - *userop_hash
      - *entrypoint_contract
      - *tx_hash
      - *sender
      - *paymaster
      - *factory

  - name: account_abstraction_erc4337_zora_account_deployed
    meta:
      blockchain: zora
      sector: erc4337
      project: erc4337
      contributors: yourname
    config:
      tags: ["zora", "erc4337", "account", "abstraction", "entrypoint"]
    description: "erc4337 account deployed on Zora"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - userop_hash
            - tx_hash
      - check_seed:
          seed_file: ref('account_abstraction_erc4337_account_deployed_seed')
          filter:
            blockchain: zora
            version: v0.5
          match_columns:
            - userop_hash
            - tx_hash
          check_columns:
            - paymaster
            - factory
      - check_seed:
          seed_file: ref('account_abstraction_erc4337_account_deployed_seed')
          filter:
            blockchain: zora
            version: v0.6
          match_columns:
            - userop_hash
            - tx_hash
          check_columns:
            - paymaster
            - factory
    columns:
      - *blockchain
      - *version
      - *block_time
      - *block_month
      - *userop_hash
      - *entrypoint_contract
      - *tx_hash
      - *sender
      - *paymaster
      - *factory
