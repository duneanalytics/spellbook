version: 2

models:
  - name: aptos_fungible_asset_metadata
    meta:
      blockchain: aptos
      project: aptos_indexer
      contributors: ying-w
    config:
      tags: ['aptos','fungible_asset']
    description: >
        Metadata for [fungible assets](https://aptos.dev/concepts/fungible-assets)
        and [legacy coins](https://aptos.dev/build/smart-contracts/aptos-coin) on Aptos.
        [Explainer for Supply and Volume](https://aptoslabs.medium.com/data-analyst-guide-to-aptos-supply-and-volume-pt-3-535e312946ad) on Aptos.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['tx_hash', 'asset_type']
    columns:
      - name: block_date
        description: The date of the block containing the transaction
      - name: tx_version
        description: The version of the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: write_set_change_index
        description: The index of the write set change
      - name: asset_type
        description: "Asset identifier"
      - name: owner_address
        description: "creator_address is the asset address for v1 and owner for v2 (can change for v2)"
      - name: asset_name
        description: "Asset name (parsed from metadata)"
      - name: asset_symbol
        description: "Asset symbol (parsed from metadata)"
      - name: decimals
        description: "Decimals (parsed from metadata)"
      - name: supply
        description: "Optional for v1, required for v2"
      - name: token_standard
        description: "Coin is v1, FungibleAsset is v2"
      - name: asset_type_migrated
        description: "Paired asset type from migration"
      - name: icon_uri
        description: "Icon URI (parsed from metadata) v2 only"
      - name: project_uri
        description: "Project URI (parsed from metadata) v2 only"
      - name: maximum
        description: "Maximum supply, if blank then 2^128-1 (parsed from metadata) v2 only"

  - name: aptos_fungible_asset_balances
    meta:
      blockchain: aptos
      project: aptos_indexer
      contributors: ying-w
    config:
      tags: ['aptos','fungible_asset']
    description: >
        Balances for [fungible assets](https://aptos.dev/concepts/fungible-assets)
        and [legacy coins](https://aptos.dev/build/smart-contracts/aptos-coin) on Aptos.
        [Explainer for activity and balances](https://aptoslabs.medium.com/data-analyst-guide-to-aptos-supply-and-volume-pt-3-535e312946ad) on Aptos.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['tx_hash', 'write_set_change_index']
    columns:
      - name: block_date
        description: The date of the block containing the transaction
      - name: tx_version
        description: The version of the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: write_set_change_index
        description: "Index of the write set change"
      - name: asset_type
        description: "Asset identifier"
      - name: owner_address
        description: "creator_address is the asset address for v1 and owner for v2 (can change for v2)"
      - name: storage_id
        description: "NULL for v1, address of FungibleStore for v2"
      - name: amount
        description: "raw asset amount (before taking into account decimals)"
      - name: is_frozen
        description: "If asset is frozen"
      - name: token_standard
        description: "Coin is v1, FungibleAsset is v2"

  - name: aptos_fungible_asset_activities
    meta:
      blockchain: aptos
      project: aptos_indexer
      contributors: ying-w
    config:
      tags: ['aptos','fungible_asset']
    description: >
        Activities for [fungible assets](https://aptos.dev/concepts/fungible-assets)
        and [legacy coins](https://aptos.dev/build/smart-contracts/aptos-coin) on Aptos.
        [Explainer for activity and balances](https://aptoslabs.medium.com/data-analyst-guide-to-aptos-supply-and-volume-pt-3-535e312946ad) on Aptos.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['tx_hash', 'event_index']
    columns:
      - name: block_date
        description: The date of the block containing the transaction
      - name: tx_version
        description: The version of the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: event_index
        description: The index of the event within the transaction
      - name: event_type
        description: The type of the event
      - name: owner_address
        description: "creator_address is the asset address for v1 and owner for v2 (can change for v2)"
      - name: storage_id
        description: "NULL for v1, address of FungibleStore for v2"
      - name: asset_type
        description: "Asset identifier"
      - name: amount
        description: "raw asset amount (before taking into account decimals)"
      - name: token_standard
        description: "Coin is v1, FungibleAsset is v2"

  - name: aptos_fungible_asset_migration
    meta:
      blockchain: aptos
      project: aptos_indexer
      contributors: ying-w
    config:
      tags: ['aptos','fungible_asset']
    description: >
        Mappings for migration of [legacy coins](https://aptos.dev/build/smart-contracts/aptos-coin)
        to [fungible assets](https://aptos.dev/concepts/fungible-assets) on Aptos.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['asset_type_v2']
    columns:
      - name: asset_type_v1
        description: "Asset identifier for v1"
      - name: asset_type_v2
        description: "Asset identifier for v2"

  - name: aptos_fungible_asset_metadata_current
    meta:
      blockchain: aptos
      project: aptos_indexer
      contributors: ying-w
    config:
      tags: ['aptos','fungible_asset']
    description: >
        Latest metadata for [fungible assets](https://aptos.dev/concepts/fungible-assets)
        and [legacy coins](https://aptos.dev/build/smart-contracts/aptos-coin) on Aptos.
        [Explainer for Supply and Volume](https://aptoslabs.medium.com/data-analyst-guide-to-aptos-supply-and-volume-pt-3-535e312946ad) on Aptos.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['asset_type']
    columns:
      - name: block_date
        description: The date of the block containing the transaction
      - name: tx_version
        description: The version of the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: write_set_change_index
        description: The index of the write set change
      - name: asset_type
        description: "Asset identifier"
      - name: owner_address
        description: "creator_address is the asset address for v1 and owner for v2 (can change for v2)"
      - name: asset_name
        description: "Asset name (parsed from metadata)"
      - name: asset_symbol
        description: "Asset symbol (parsed from metadata)"
      - name: decimals
        description: "Decimals (parsed from metadata)"
      - name: supply
        description: "Optional for v1, required for v2"
      - name: token_standard
        description: "Coin is v1, FungibleAsset is v2"
      - name: asset_type_migrated
        description: "Paired asset type from migration"
      - name: icon_uri
        description: "Icon URI (parsed from metadata) v2 only"
      - name: project_uri
        description: "Project URI (parsed from metadata) v2 only"
      - name: maximum
        description: "Maximum supply, typically 2^128-1 (parsed from metadata) v2 only"

  - name: aptos_usdt_volume
    meta:
      blockchain: aptos
      project: aptos_stablecoins
      contributors: ying-w
    config:
      tags: ['aptos','stablecoins']
    description: usdt mint, burn, withdraw, deposit volume
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['tx_hash', 'event_index']
    columns:
      - name: tx_version
        description: The version of the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: block_date
        description: The date of the block containing the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: event_index
        description: The index of the event within the transaction
      - name: activity_type
        description: Mint, Burn, Withdraw, Deposit
      - name: amount
        description: raw asset amount (before taking into account decimals)
      - name: fungible_store
        description: address of fungible store (aka storage_id)
      - name: store_owner
        description: address of direct owner of fungible store

  - name: aptos_usdc_volume
    meta:
      blockchain: aptos
      project: aptos_stablecoins
      contributors: ying-w
    config:
      tags: ['aptos','stablecoins']
    description: usdc mint, burn, withdraw, deposit volume
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['tx_hash', 'event_index']
    columns:
      - name: tx_version
        description: The version of the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: block_date
        description: The date of the block containing the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: event_index
        description: The index of the event within the transaction
      - name: activity_type
        description: Mint, Burn, Withdraw, Deposit
      - name: amount
        description: raw asset amount (before taking into account decimals)
      - name: fungible_store
        description: address of fungible store (aka storage_id)
      - name: store_owner
        description: address of direct owner of fungible store

  - name: aptos_usdt_transfers
    meta:
      blockchain: aptos
      project: aptos_stablecoins
      contributors: ying-w
    config:
      tags: ['aptos','stablecoins']
    description: 1-to-1 mapping of transfers using FIFO logic when ambiguous
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['tx_hash', 'to_index', 'from_index']
    columns:
      - name: tx_version
        description: The version of the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: block_date
        description: The date of the block containing the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: session_id
        description: Virtual index for transfer within transaction
      - name: from_account
        description: Owner of fungible store that origninates funds
      - name: from_store
        description: Address of fungible store that origninates funds
      - name: to_account
        description: Owner of fungible store that receives funds
      - name: to_store
        description: Address of fungible store that receives funds
      - name: amount
        description: raw asset amount (before taking into account decimals)
      - name: from_index
        description: Event index that funds originate from (Mint or Withdraw)
      - name: to_index
        description: Event index that funds are received (Burn or Deposit)
      - name: from_many
        description: Transfer does not take entire amount of originating event
      - name: to_many
        description: Transfer does not take entire amount of receiving event
      - name: has_mint
        description: Whether the transfer is a mint
      - name: has_burn
        description: Whether the transfer is a burn

  - name: aptos_usdc_transfers
    meta:
      blockchain: aptos
      project: aptos_stablecoins
      contributors: ying-w
    config:
      tags: ['aptos','stablecoins']
    description: 1-to-1 mapping of transfers using FIFO logic when ambiguous
    data_tests:
      - dbt_utils.unique_combination_of_columns:
         combination_of_columns: ['tx_hash', 'to_index', 'from_index']
    columns:
      - name: tx_version
        description: The version of the transaction
      - name: tx_hash
        description: The hash of the transaction
      - name: block_date
        description: The date of the block containing the transaction
      - name: block_time
        description: The timestamp of the block containing the transaction
      - name: block_month
        description: The month of the block containing the transaction
      - name: session_id
        description: Virtual index for transfer within transaction
      - name: from_account
        description: Owner of fungible store that originates funds
      - name: from_store
        description: Address of fungible store that originates funds
      - name: to_account
        description: Owner of fungible store that receives funds
      - name: to_store
        description: Address of fungible store that receives funds
      - name: amount
        description: raw asset amount (before taking into account decimals)
      - name: from_index
        description: Event index that funds originate from (Mint or Withdraw)
      - name: to_index
        description: Event index that funds are received (Burn or Deposit)
      - name: from_many
        description: Transfer does not take entire amount of originating event
      - name: to_many
        description: Transfer does not take entire amount of receiving event
      - name: has_mint
        description: Whether the transfer is a mint
      - name: has_burn
        description: Whether the transfer is a burn
