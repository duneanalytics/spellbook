version: 2

models:
  # Core dimension table (dependency for silver models)
  - name: thorchain_core_dim_block
    description: "Core block dimension table for Thorchain with time-based analytics"
    columns:
      - name: dim_block_id
        description: "Surrogate key for block dimension"
        data_tests:
          - unique
          - not_null
      - name: block_id
        description: "Block height (block_id)"
        data_tests:
          - not_null
      - name: block_time
        description: "Block timestamp (Spellbook standard)"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (alias for compatibility)"
      - name: block_date
        description: "Block date for partitioning"
      - name: block_hour
        description: "Block hour for time-based analysis"
      - name: block_week
        description: "Block week for time-based analysis"
      - name: block_month
        description: "Block month for partitioning"
      - name: block_quarter
        description: "Block quarter for time-based analysis"
      - name: block_year
        description: "Block year for time-based analysis"
      - name: block_dayofmonth
        description: "Day of month (1-31)"
      - name: block_dayofweek
        description: "Day of week (1=Monday, 7=Sunday)"
      - name: block_dayofyear
        description: "Day of year (1-366)"
      - name: timestamp
        description: "Raw block timestamp for joins"
      - name: hash
        description: "Block hash"
      - name: agg_state
        description: "Aggregated state data"
      - name: _inserted_timestamp
        description: "Record insertion timestamp"
      - name: _audit_run_id
        description: "Audit run identifier"
      - name: inserted_timestamp
        description: "Record insertion timestamp"
      - name: modified_timestamp
        description: "Record modification timestamp"

  # Silver Models
  - name: thorchain_silver_rune_price
    description: "RUNE price data processed from Thorchain"
    columns:
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: rune_price_usd
        description: "RUNE price in USD"
      - name: symbol
        description: "Token symbol (RUNE)"
      - name: blockchain
        description: "Blockchain (thorchain)"

  - name: thorchain_silver_prices
    description: "Combined price data for Thorchain tokens including RUNE and external assets"
    columns:
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: price
        description: "Token price in USD"
      - name: symbol
        description: "Token symbol"
      - name: contract_address
        description: "Contract address for price joins"

  - name: thorchain_silver_add_events
    description: "Processed liquidity add events from Thorchain"
    columns:
      - name: tx_hash
        description: "Transaction hash"
        data_tests:
          - not_null
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: asset_amount
        description: "Asset amount added to liquidity"
      - name: rune_amount
        description: "RUNE amount added to liquidity"
      - name: pool
        description: "Pool identifier"

  - name: thorchain_silver_withdraw_events
    description: "Processed liquidity withdraw events from Thorchain"
    columns:
      - name: tx_hash
        description: "Transaction hash"
        data_tests:
          - not_null
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: emit_asset_amount
        description: "Asset amount withdrawn from liquidity"
      - name: emit_rune_amount
        description: "RUNE amount withdrawn from liquidity"
      - name: pool
        description: "Pool identifier"

  - name: thorchain_silver_swap_events
    description: "Processed swap events from Thorchain"
    columns:
      - name: tx_hash
        description: "Transaction hash"
        data_tests:
          - not_null
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: from_asset_amount
        description: "Amount of asset being sold"
      - name: to_asset_amount
        description: "Amount of asset being bought"
      - name: pool
        description: "Pool identifier"

  - name: thorchain_silver_streaming_swap_details_events
    description: "Processed streaming swap details events from Thorchain"
    columns:
      - name: tx_id
        description: "Transaction ID"
        data_tests:
          - not_null
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: stream_count
        description: "Number of streams in the swap"
      - name: deposit_amount
        description: "Total deposit amount"

  - name: thorchain_silver_fee_events
    description: "Processed fee events from Thorchain"
    columns:
      - name: tx_hash
        description: "Transaction hash"
        data_tests:
          - not_null
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: asset_amount
        description: "Fee amount in asset"
      - name: pool_deduct_amount
        description: "Amount deducted from pool"

  - name: thorchain_silver_pending_liquidity_events
    description: "Processed pending liquidity events from Thorchain"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: pool
        description: "Pool identifier"
      - name: pending_type
        description: "Type of pending operation"

  - name: thorchain_silver_swaps
    description: "Curated swaps rollup combining swap events with streaming swap details"
    columns:
      - name: tx_hash
        description: "Transaction hash"
        data_tests:
          - not_null
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: from_amount_usd
        description: "USD value of asset sold"
      - name: to_amount_usd
        description: "USD value of asset bought"
      - name: involves_rune
        description: "Whether the swap involves RUNE"

  - name: thorchain_silver_liquidity_actions
    description: "Curated liquidity actions combining add and withdraw events"
    columns:
      - name: tx_hash
        description: "Transaction hash"
        data_tests:
          - not_null
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - not_null
      - name: action_type
        description: "Type of action (add/withdraw)"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: total_value_usd
        description: "Total USD value of the liquidity action"
      - name: liquidity_type
        description: "Type of liquidity provision (symmetric/asymmetric)"

  # Gold Models
  - name: thorchain_silver_pool_events
    description: "Silver table for Thorchain pool status events"  
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null

  - name: thorchain_silver_block_log
    description: "Silver table for Thorchain block log with date/time dimensions"
    columns:
      - name: height
        description: "Block height"
        data_tests:
          - unique
          - not_null
      - name: block_timestamp
        description: "Block timestamp"
      - name: block_time
        description: "Block timestamp (Spellbook standard)"
      - name: block_date
        description: "Block date"
      - name: block_hour
        description: "Block hour (truncated)"
      - name: block_week
        description: "Block week (truncated)"
      - name: block_month
        description: "Block month (truncated)"
      - name: block_quarter
        description: "Block quarter (truncated)"
      - name: block_year
        description: "Block year (truncated)"
      - name: block_dayofmonth
        description: "Day of month"
      - name: block_dayofweek
        description: "Day of week"
      - name: block_dayofyear
        description: "Day of year"
      - name: timestamp
        description: "Raw timestamp (unix nanoseconds)"
      - name: hash
        description: "Block hash"
      - name: agg_state
        description: "Aggregate state"

  - name: thorchain_silver_constants
    description: "Silver view for Thorchain constants (key-value configuration parameters)"
    columns:
      - name: key
        description: "Constant key/name"
      - name: value
        description: "Constant value"

  - name: thorchain_silver_upgrades
    description: "Silver table for Thorchain upgrades (switch events with pricing)"
    columns:
      - name: _unique_key
        description: "Composite unique key"
        data_tests:
          - unique
          - not_null
      - name: block_id
        description: "Block ID"
      - name: block_time
        description: "Block timestamp"
      - name: block_date
        description: "Block date"
      - name: block_month
        description: "Block month (for partitioning)"
      - name: tx_id
        description: "Transaction ID"
      - name: from_address
        description: "From address"
      - name: to_address
        description: "To address"
      - name: burn_asset
        description: "Burned asset"
      - name: rune_amount
        description: "RUNE amount (decimal)"
      - name: rune_amount_usd
        description: "RUNE amount in USD"
      - name: mint_amount
        description: "Mint amount (decimal)"
      - name: mint_amount_usd
        description: "Mint amount in USD"

  - name: thorchain_silver_stake_events
    description: "Silver table for Thorchain stake events"
    columns:
      - name: event_id
        description: "Unique event identifier" 
        data_tests:
          - unique
          - not_null

  - name: thorchain_silver_daily_pool_stats
    description: "Silver table for daily Thorchain pool statistics"
    columns:
      - name: _unique_key
        description: "Unique identifier"
        data_tests:
          - unique
          - not_null

  - name: thorchain_silver_bond_events
    description: "Silver table for Thorchain bond events from validators"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: tx_id
        description: "Transaction ID"
      - name: bond_type
        description: "Type of bond operation"
      - name: e8
        description: "Bond amount in e8 format"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null

  - name: thorchain_silver_update_node_account_status_events
    description: "Silver table for Thorchain node status change events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: node_address
        description: "Node address"
      - name: current_status
        description: "Current node status"
      - name: former_status
        description: "Previous node status"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null

  - name: thorchain_silver_transfer_events
    description: "Silver table for Thorchain asset transfer events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - not_null
      - name: from_address
        description: "From address"
        data_tests:
          - not_null
      - name: to_address
        description: "To address"
        data_tests:
          - not_null
      - name: asset
        description: "Asset identifier"
      - name: amount_e8
        description: "Transfer amount in e8 format"
      - name: amount
        description: "Transfer amount (decimal)"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"

  - name: thorchain_silver_transfers
    description: "Silver table for Thorchain transfers with USD pricing"
    columns:
      - name: _unique_key
        description: "Unique composite key"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"
      - name: block_id
        description: "Block height"
      - name: from_address
        description: "From address"
      - name: to_address
        description: "To address"
      - name: asset
        description: "Asset identifier"
      - name: rune_amount
        description: "Transfer amount in RUNE"
      - name: rune_amount_usd
        description: "Transfer amount in USD"
      - name: event_id
        description: "Unique event identifier"

  - name: thorchain_silver_outbound_events
    description: "Silver table for Thorchain outbound events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - not_null
      - name: tx_id
        description: "Transaction hash (null for internal THOR blockchain transactions)"
      - name: blockchain
        description: "Blockchain"
      - name: from_address
        description: "From address"
      - name: to_address
        description: "To address"
      - name: asset
        description: "Asset identifier"
      - name: asset_e8
        description: "Asset amount in e8 format"
      - name: asset_amount
        description: "Asset amount (decimal)"
      - name: memo
        description: "Transaction memo"
      - name: in_tx
        description: "Inbound transaction hash"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"
      - name: _tx_type
        description: "Transaction type"

  - name: thorchain_silver_scheduled_outbound_events
    description: "Silver table for Thorchain scheduled outbound events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: blockchain
        description: "Blockchain"
      - name: to_address
        description: "To address"
      - name: asset
        description: "Asset identifier"
      - name: asset_e8
        description: "Asset amount in e8 format"
      - name: asset_amount
        description: "Asset amount (decimal)"
      - name: asset_decimals
        description: "Asset decimals"
      - name: gas_rate
        description: "Gas rate"
      - name: memo
        description: "Transaction memo"
      - name: in_hash
        description: "Inbound transaction hash"
      - name: out_hash
        description: "Outbound transaction hash"
      - name: max_gas_amount
        description: "Maximum gas amount"
      - name: max_gas_decimals
        description: "Maximum gas decimals"
      - name: max_gas_asset
        description: "Maximum gas asset"
      - name: module_name
        description: "Module name"
      - name: vault_pub_key
        description: "Vault public key"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"

  - name: thorchain_silver_gas_events
    description: "Silver table for Thorchain gas events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: asset
        description: "Asset identifier"
      - name: asset_e8
        description: "Asset amount in e8 format"
      - name: asset_amount
        description: "Asset amount (decimal)"
      - name: rune_e8
        description: "RUNE amount in e8 format"
      - name: rune_amount
        description: "RUNE amount (decimal)"
      - name: tx_count
        description: "Transaction count"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"

  - name: thorchain_silver_loan_open_events
    description: "Silver table for Thorchain loan open events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: owner
        description: "Loan owner address"
      - name: collateralization_ratio
        description: "Collateralization ratio"
      - name: collateral_asset
        description: "Collateral asset identifier"
      - name: target_asset
        description: "Target asset identifier"
      - name: collateral_deposited
        description: "Collateral deposited amount"
      - name: debt_issued
        description: "Debt issued amount"
      - name: tx_id
        description: "Transaction ID"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"

  - name: thorchain_silver_loan_repayment_events
    description: "Silver table for Thorchain loan repayment events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - unique
          - not_null
      - name: owner
        description: "Loan owner address"
      - name: collateral_asset
        description: "Collateral asset identifier"
      - name: collateral_withdrawn
        description: "Collateral withdrawn amount"
      - name: debt_repaid
        description: "Debt repaid amount"
      - name: tx_id
        description: "Transaction ID"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"

  - name: thorchain_silver_refund_events
    description: "Silver table for Thorchain refund events"
    columns:
      - name: event_id
        description: "Unique event identifier"
        data_tests:
          - not_null
      - name: tx_id
        description: "Transaction hash"
        data_tests:
          - not_null
      - name: blockchain
        description: "Blockchain"
      - name: from_address
        description: "From address"
      - name: to_address
        description: "To address"
      - name: asset
        description: "Primary asset identifier"
      - name: asset_e8
        description: "Primary asset amount in e8 format"
      - name: asset_amount
        description: "Primary asset amount (decimal)"
      - name: asset_2nd
        description: "Secondary asset identifier"
      - name: asset_2nd_e8
        description: "Secondary asset amount in e8 format"
      - name: asset_2nd_amount
        description: "Secondary asset amount (decimal)"
      - name: memo
        description: "Transaction memo"
      - name: code
        description: "Refund code"
      - name: reason
        description: "Refund reason"
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: block_timestamp
        description: "Block timestamp (unix nanoseconds)"
      - name: _tx_type
        description: "Transaction type"

  - name: thorchain_silver_total_value_locked
    description: "Silver table for Thorchain total value locked calculations"
    columns:
      - name: block_date
        description: "Date"
        data_tests:
          - unique
          - not_null
      - name: total_value_pooled
        description: "Total value pooled"
      - name: total_value_bonded
        description: "Total value bonded"  
      - name: total_value_locked
        description: "Total value locked (pooled + bonded)"

  - name: thorchain_silver_block_rewards
    description: "Silver table for daily Thorchain block rewards"
    columns:
      - name: block_date
        description: "Date"
        data_tests:
          - unique
          - not_null
      - name: liquidity_fee
        description: "Liquidity fees earned"
      - name: block_rewards
        description: "Block rewards earned"
      - name: earnings
        description: "Total earnings"
      - name: avg_node_count
        description: "Average node count"

  - name: thorchain_silver_total_block_rewards
    description: "Silver table for total Thorchain block rewards by entity"
    columns:
      - name: _unique_key
        description: "Unique identifier (block_id + reward_entity)"
        data_tests:
          - unique
          - not_null
      - name: block_time
        description: "Block timestamp"
        data_tests:
          - not_null
      - name: reward_entity
        description: "Reward entity (pool name or 'bond_holders')"
      - name: rune_amount
        description: "RUNE reward amount"
      - name: rune_amount_usd
        description: "RUNE reward amount in USD"

  - name: thorchain_silver_daily_tvl
    description: "Silver table for daily Thorchain TVL with USD pricing"
    columns:
      - name: block_date
        description: "Date"
        data_tests:
          - unique
          - not_null
      - name: total_value_pooled_usd
        description: "Total pooled value in USD"
      - name: total_value_locked_usd
        description: "Total locked value in USD"

  - name: thorchain_silver_pool_block_statistics
    description: "Silver table for complex daily Thorchain pool statistics"
    columns:
      - name: _unique_key
        description: "Unique identifier (block_date + asset)"
        data_tests:
          - unique
          - not_null

  - name: thorchain_silver_daily_earnings
    description: "Silver table for daily Thorchain earnings with USD pricing"
    columns:
      - name: block_date
        description: "Date"
        data_tests:
          - unique
          - not_null
      - name: liquidity_fees
        description: "Liquidity fees earned"
      - name: liquidity_fees_usd
        description: "Liquidity fees in USD"
      - name: block_rewards
        description: "Block rewards earned"
      - name: block_rewards_usd
        description: "Block rewards in USD"
      - name: total_earnings
        description: "Total earnings"
      - name: total_earnings_usd
        description: "Total earnings in USD"
      - name: earnings_to_nodes
        description: "Earnings to nodes"
      - name: earnings_to_nodes_usd
        description: "Earnings to nodes in USD"
      - name: earnings_to_pools
        description: "Earnings to pools"
      - name: earnings_to_pools_usd
        description: "Earnings to pools in USD"
      - name: avg_node_count
        description: "Average node count"

