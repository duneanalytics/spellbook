version: 2

models:
  - name: tokens_story_base_transfers
    meta:
      blockchain: story
      sector: tokens
      contributors: cursor
    config:
      tags: ['tokens','transfers', 'story']
    description: >
      Token transfers
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - unique_key
    columns:
      - name: unique_key
        description: "Surrogate key to identify unique row"
      - name: blockchain
        description: "The blockchain of the transfers"
      - name: block_date
        description: "The date of the block"
      - name: block_time
        description: "The time of the block"
      - name: block_number
        description: "The block number"
      - name: tx_hash
        description: "The transaction hash"
      - name: evt_index
        description: "The log event index of the transfer if any"
      - name: trace_address
        description: "The trace address of the transfer if any"
      - name: token_standard
        description: "The token standard of the transfer"
      - name: tx_from
        description: "The transaction sender"
      - name: tx_to
        description: "The transaction receiver"
      - name: tx_index
        description: "The transaction index"
      - name: from
        description: "The sender of the transfer"
      - name: to
        description: "The receiver of the transfer"
      - name: contract_address
        description: "The contract address of the transfer"
      - name: amount_raw
        description: "The raw amount of the transfer"

  - name: tokens_story_transfers
    meta:
      blockchain: story
      sector: tokens
      contributors: cursor
    config:
      tags: ['tokens','transfers', 'story']
    description: >
      Token transfers
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - unique_key
    columns:
      - name: unique_key
        description: "Surrogate key to identify unique row"
      - name: blockchain
        description: "The blockchain of the transfers"
      - name: block_date
        description: "The date of the block"
      - name: block_time
        description: "The time of the block"
      - name: block_number
        description: "The block number"
      - name: tx_hash
        description: "The transaction hash"
      - name: evt_index
        description: "The log event index of the transfer if any"
      - name: trace_address
        description: "The trace address of the transfer if any"
      - name: token_standard
        description: "The token standard of the transfer"
      - name: tx_from
        description: "The transaction sender"
      - name: tx_to
        description: "The transaction receiver"
      - name: tx_index
        description: "The transaction index"
      - name: from
        description: "The sender of the transfer"
      - name: to
        description: "The receiver of the transfer"
      - name: contract_address
        description: "The contract address of the transfer"
      - name: symbol
        description: "The token symbol transferred"
      - name: amount_raw
        description: "The raw amount of the transfer"
      - name: amount
        description: "The formatted amount of the transfer"
      - name: price_usd
        description: "The USD price used to calculate the amount_usd"
      - name: amount_usd
        description: "The USD amount of the transfer"
  
  - name: tokens_story_net_transfers_daily
    meta:
      blockchain: story
      sector: tokens
      contributors: 0xRob, cursor
    config:
      tags: ['tokens', 'net_transfers', 'daily']
    description: "Total transfer amount per day"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - blockchain
            - block_date

  - name: tokens_story_net_transfers_daily_asset
    meta:
      blockchain: story
      sector: tokens
      contributors: 0xRob, cursor
    config:
      tags: ['tokens', 'net_transfers']
    description: "Total transfer amount per day per asset"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - blockchain
            - block_date
            - contract_address

  - name: tokens_story_transfers_from_traces
    meta:
      blockchain: story
      sector: tokens
      contributors: cursor
    config:
      tags: ['tokens', 'transfers', 'story']
    description: "Native token transfers from traces on Story"

  - name: tokens_story_transfers_from_traces_base
    meta:
      blockchain: story
      sector: tokens
      contributors: cursor
    config:
      tags: ['tokens', 'transfers', 'story']
    description: "Base native token transfers from traces on Story"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - unique_key

  - name: tokens_story_transfers_from_traces_base_wrapper_deposits
    meta:
      blockchain: story
      sector: tokens
      contributors: cursor
    config:
      tags: ['tokens', 'transfers', 'story']
    description: "Wrapper deposit transfers from traces on Story"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - unique_key
