version: 2

models:
  - name: tokens_transfers
    meta:
      docs_slug: /curated/asset-tracking/evm/token-transfers
      sector: tokens
      contributors: aalan3, jeff-dude, 0xBoxer, hildobby, hosuke, tomfutago
    config:
      tags: ['tokens','transfers','evm']
    description: >
      Transfers of all kinds of fungible tokens across all EVM-compatible networks on Dune. This model contains
      EVM-only data. For a unified view that includes both EVM and non-EVM chains, use
      tokens_multichain.transfers instead.
    columns:
      - &unique_key
        name: unique_key
        description: "Surrogate key to identify unique row"
      - &blockchain_transfer
        name: blockchain
        description: "The blockchain of the transfer"
      - &block_month_transfer
        name: block_month
        description: "The month of the block"
      - &block_date_transfer
        name: block_date
        description: "The date of the block"
      - &block_time_transfer
        name: block_time
        description: "The time of the block"
      - &block_number_transfer
        name: block_number
        description: "The block number"
      - &tx_hash_transfer
        name: tx_hash
        description: "The transaction hash"
      - &evt_index_transfer
        name: evt_index
        description: "The log event index of the transfer"
      - &trace_address_transfer
        name: trace_address
        description: "The trace address of the transfer"
      - &token_standard_transfer
        name: token_standard
        description: "The token standard of the transfer"
      - &tx_from_transfer
        name: tx_from
        description: "The transaction sender"
      - &tx_to_transfer
        name: tx_to
        description: "The transaction receiver"
      - &tx_index_transfer
        name: tx_index
        description: "The transaction index"
      - &from_transfer
        name: from
        description: "The sender of the transfer"
      - &to_transfer
        name: to
        description: "The receiver of the transfer"
      - &contract_address_transfer
        name: contract_address
        description: "The contract address of the transfer"
      - &symbol_transfer
        name: symbol
        description: "The token symbol transferred"
      - &amount_raw_transfer
        name: amount_raw
        description: "The raw amount of the transfer"
      - &amount_transfer
        name: amount
        description: "The display amount of the transfer"
      - &price_usd_transfer
        name: price_usd
        description: "The USD price used to calculate the amount_usd"
      - &amount_usd_transfer
        name: amount_usd
        description: "The USD amount of the transfer"

  - name: tokens_net_transfers_daily
    meta:
      sector: tokens
      contributors: jeff-dude, krishhh, tomfutago
    config:
      tags: ['tokens', 'net_transfers']
    description: &net_transfers_description |
      "The amount returned is the net received amount in a transaction. This gets to the heart of what was really transfered
      in a transaction, as the amounts that go from and back to a single address don't actually count as real transfers.
      For example, if I give you a dollar and then you give it back to me in a single transaction that should count as $0 
      because nothing was effectively transferred. If I give you two dollars and you give one back to me that should count as $1
      because one dollar was effectively transfered.

      The reason we filter where net_received is greater than 0 is because if you sum the negative net received (aka sent)
      with the positive net received (aka received) it adds up to 0 since the net sent should equal the net received. 
      For example, if I give you $1 that's -1 sent (from me) and +1 received (by you) which adds to 0. 
      This query counts the received to show that $1 was effectively transfered."

  - name: tokens_net_transfers_daily_asset
    meta:
      sector: tokens
      contributors: jeff-dude, krishhh, tomfutago
    config:
      tags: ['tokens', 'net_transfers']
    description: "Total transfer amount per day per asset across chains"

  - name: tokens_evm_transfers
    meta:
      sector: tokens
      contributors: kryptaki
    config:
      tags: ['tokens','transfers', 'evm']
    description: >
      Fungible token transfers across all EVM-compatible networks only. This model contains the same data as tokens.transfers
      but is located in the tokens_evm schema to explicitly indicate it contains EVM-only data. Use this model when
      you need to query EVM transfers specifically, or use tokens_multichain.transfers if you need transfers from
      both EVM and non-EVM chains.
    columns:
      - <<: *unique_key
      - <<: *blockchain_transfer
      - <<: *block_month_transfer
      - <<: *block_date_transfer
      - <<: *block_time_transfer
      - <<: *block_number_transfer
      - <<: *tx_hash_transfer
      - <<: *evt_index_transfer
      - <<: *trace_address_transfer
      - <<: *token_standard_transfer
      - <<: *tx_from_transfer
      - <<: *tx_to_transfer
      - <<: *tx_index_transfer
      - <<: *from_transfer
      - <<: *to_transfer
      - <<: *contract_address_transfer
      - <<: *symbol_transfer
      - <<: *amount_raw_transfer
      - <<: *amount_transfer
      - <<: *price_usd_transfer
      - <<: *amount_usd_transfer

  - name: tokens_multichain_transfers
    meta:
      sector: tokens
      contributors: kryptaki
    config:
      tags: ['tokens','transfers', 'multichain']
    description: >
      Unified view of fungible token transfers across EVM-compatible chains and Solana with a chain-agnostic schema.
      For EVM-only transfers, use tokens_evm.transfers, and for Solana-only transfers, use tokens_solana.transfers.
    columns:
      - <<: *unique_key
      - <<: *blockchain_transfer
      - <<: *block_time_transfer
      - <<: *block_date_transfer
      - <<: *block_month_transfer
      - name: block_number
        description: "The block number or slot number"
      - name: tx_id
        description: "The transaction identifier (hash or id), stored as string"
      - name: from_address
        description: "The sender of the transfer, stored as string"
      - name: to_address
        description: "The receiver of the transfer, stored as string"
      - name: tx_signer
        description: "The address that signed the transaction, stored as string"
      - name: token_address
        description: "The token address of the transfer, stored as string"
      - name: token_symbol
        description: "The token symbol transferred"
      - <<: *token_standard_transfer
      - <<: *amount_raw_transfer
      - <<: *amount_transfer
      - <<: *amount_usd_transfer
    
