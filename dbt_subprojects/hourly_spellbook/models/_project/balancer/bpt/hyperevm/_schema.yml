version: 2

_blockchain: &blockchain
  name: blockchain
  description: "Blockchain network (e.g. plasma)"

_version: &version
  name: version
  description: "Schema version"

_contract_address: &contract_address
  name: contract_address
  description: "Smart contract address"

_block_date: &block_date
  name: block_date
  description: "Block date (YYYY-MM-DD)"

_block_month: &block_month
  name: block_month
  description: "Block month (YYYY-MM format)"

_evt_tx_hash: &evt_tx_hash
  name: evt_tx_hash
  description: "Transaction hash"

_evt_index: &evt_index
  name: evt_index
  description: "Event index"

_evt_block_time: &evt_block_time
  name: evt_block_time
  description: "Block timestamp"

_evt_block_number: &evt_block_number
  name: evt_block_number
  description: "Block number"

_from: &from
  name: from
  description: "Sender address"

_to: &to
  name: to
  description: "Recipient address"

_value: &value
  name: value
  description: "Transfer value (raw amount)"

_day: &day
  name: day
  description: "Aggregation day (YYYY-MM-DD)"

_decimals: &decimals
  name: decimals
  description: "Token decimals"

_bpt_price: &bpt_price
  name: bpt_price
  description: "Balancer Pool Token price (USD)"

_pool_type: &pool_type
  name: pool_type
  description: "Pool type (weighted, stable, etc.)"

_pool_symbol: &pool_symbol
  name: pool_symbol
  description: "Pool symbol"

_token_address: &token_address
  name: token_address
  description: "Token address"

_supply: &supply
  name: supply
  description: "Total supply"

_label: &label
  name: label
  description: "Change label (mint/burn/etc.)"

_delta_amount_raw: &delta_amount_raw
  name: delta_amount_raw
  description: "Change amount (raw integer)"

_delta_amount: &delta_amount
  name: delta_amount
  description: "Change amount (decimal)"

_daily_delta: &daily_delta
  name: daily_delta
  description: "Net change in supply per day"

models:
  - name: balancer_v3_hyperevm_transfers_bpt
    meta:
      blockchain: hyperevm
      project: balancer_v3
      contributors: amandadalle, giovanasoldatelli, tiagoponciano
    config:
      tags: ['hyperevm', 'bpt', 'transfers']
    description: >
      Balancer Pool Token (BPT) transfer logs on Balancer, an automated portfolio manager and trading platform, on plasma.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - evt_tx_hash
            - evt_index
            - block_date
    columns:
      - *blockchain
      - *version
      - *contract_address
      - *block_date
      - *block_month
      - *evt_tx_hash
      - *evt_index
      - *evt_block_time
      - *evt_block_number
      - *from
      - *to
      - *value

  - name: balancer_v3_hyperevm_bpt_prices
    meta:
      blockchain: hyperevm
      project: balancer_v3
      contributors: amandadalle, giovanasoldatelli, tiagoponciano
    config:
      tags: ['hyperevm', 'bpt', 'prices']
    description: >
      Balancer Pool Token (BPT) daily price by pool on Balancer, an automated portfolio manager and trading platform.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - blockchain
            - day
            - contract_address
    columns:
      - *blockchain
      - *day
      - *version
      - *decimals
      - *contract_address
      - *bpt_price

  - name: balancer_v3_hyperevm_bpt_supply
    meta:
      blockchain: hyperevm
      project: balancer_v3
      contributors: amandadalle, giovanasoldatelli, tiagoponciano
    config:
      tags: ['hyperevm', 'bpt', 'supply']
    description: >
      Balancer Pool Token (BPT) supply by pool on Balancer, an automated portfolio manager and trading platform.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - day
            - blockchain
            - token_address
    columns:
      - *day
      - *pool_type
      - *version
      - *blockchain
      - *token_address
      - *supply

  - name: balancer_v3_hyperevm_bpt_supply_changes
    meta:
      blockchain: hyperevm
      project: balancer_v3
      contributors: amandadalle, giovanasoldatelli, tiagoponciano
    config:
      tags: ['hyperevm', 'bpt', 'supply', 'changes']
    description: >
      Balancer Pool Token (BPT) supply change events.
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - evt_tx_hash
            - evt_index
            - label
    columns:
      - *block_date
      - *evt_block_time
      - *evt_block_number
      - *blockchain
      - *evt_tx_hash
      - *evt_index
      - *pool_type
      - *pool_symbol
      - *version
      - *label
      - *token_address
      - *delta_amount_raw
      - *delta_amount

  - name: balancer_v3_hyperevm_bpt_supply_changes_daily
    meta:
      blockchain: hyperevm
      project: balancer_v3
      contributors: amandadalle, giovanasoldatelli, tiagoponciano
    config:
      tags: ['hyperevm', 'bpt', 'supply', 'changes']
    description: >
      Balancer Pool Token (BPT) supply change events. grouped by day
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - block_date
            - blockchain
            - token_address
    columns:
      - *block_date
      - *blockchain
      - *pool_type
      - *pool_symbol   
      - *version 
      - *token_address
      - *daily_delta   
