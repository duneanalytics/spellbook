version: 2

models:
  - name: pool_map
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["static", "sui", "dex"]
    description: "Maps Sui pool IDs to token pairs (coin_type_a, coin_type_b)"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - pool_id
      - not_null:
          column_name: pool_id
      - not_null:
          column_name: coin_type_a
      - not_null:
          column_name: coin_type_b

  - name: coin_info
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["static", "sui", "dex"]
    description: "Sui coin metadata including symbol and decimals"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - coin_type
      - not_null:
          column_name: coin_type
      - not_null:
          column_name: coin_symbol
      - not_null:
          column_name: coin_decimals

  - name: momentum_sui_base_trades
    meta:
      blockchain: sui
      sector: dex
      project: momentum
      contributors: krishhh
    config:
      tags: ["sui", "dex", "trades", "momentum"]
    description: "Momentum DEX trades on Sui blockchain"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_digest
            - event_index
      - not_null:
          column_name: amount_in
      - not_null:
          column_name: amount_out
      - not_null:
          column_name: pool_id
      - not_null:
          column_name: protocol
  - name: cetus_sui_base_trades
    meta:
      sector: dex
      project: cetus
    config:
      tags: ["sui","dex","trades","cetus"]
    description: "Cetus Sui base trades"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: [transaction_digest, event_index]

  - name: dex_sui_raw_base_trades
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["sui", "dex", "trades", "raw"]
    description: "Raw union of all Sui DEX protocol trades"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - protocol
            - transaction_digest
            - event_index
      - not_null:
          column_name: amount_in
      - not_null:
          column_name: amount_out

  - name: dex_sui_base_trades
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["sui", "dex", "trades"]
    description: "Processed Sui DEX trades with resolved token types and metadata"
    data_tests:
      - check_columns_dex_base_trades
      - check_dex_info_relationship
      - test_acceptable_usd_amount:
          column_name: amount_usd
          max_value: 1000000000
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - protocol
            - transaction_digest
            - event_index
      - not_null:
          column_name: coin_type_in
      - not_null:
          column_name: coin_type_out
      - not_null:
          column_name: amount_in
      - not_null:
          column_name: amount_out
