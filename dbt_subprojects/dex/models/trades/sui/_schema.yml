version: 2

models:
  - name: pool_map
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["static", "sui", "dex"]
    description: "Maps Sui pool IDs to token pairs (coin_type_a, coin_type_b)"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - pool_id
      - not_null:
          column_name: pool_id
      - not_null:
          column_name: coin_type_a
      - not_null:
          column_name: coin_type_b

  - name: coin_info
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["static", "sui", "dex"]
    description: "Sui coin metadata including symbol and decimals"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - coin_type
      - not_null:
          column_name: coin_type
      - not_null:
          column_name: coin_symbol
      - not_null:
          column_name: coin_decimals

  - name: momentum_sui_base_trades
    meta:
      blockchain: sui
      sector: dex
      project: momentum
      contributors: krishhh
    config:
      tags: ["sui", "dex", "trades", "momentum"]
    description: "Momentum DEX trades on Sui blockchain"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_digest
            - event_index
      - not_null:
          column_name: token_sold_amount_raw
      - not_null:
          column_name: token_bought_amount_raw
      - not_null:
          column_name: token_sold_address
      - not_null:
          column_name: token_bought_address

  - name: dex_sui_raw_base_trades
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["sui", "dex", "trades", "raw"]
    description: "Raw union of all Sui DEX protocol trades"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - blockchain
            - project
            - version
            - tx_hash
            - evt_index
      - not_null:
          column_name: token_sold_amount_raw
      - not_null:
          column_name: token_bought_amount_raw
      - accepted_values:
          column_name: blockchain
          values: ["sui"]

  - name: dex_sui_base_trades
    meta:
      blockchain: sui
      sector: dex
      contributors: krishhh
    config:
      tags: ["sui", "dex", "trades"]
    description: "Processed Sui DEX trades with resolved token types and metadata"
    data_tests:
      - check_columns_dex_base_trades
      - check_dex_info_relationship
      - test_acceptable_usd_amount:
          column_name: amount_usd
          max_value: 1000000000

sources:
  - name: sui
    description: "Sui blockchain data"
    tables:
      - name: events
        description: "Sui blockchain events"
        columns:
          - name: event_type
            description: "Type of the event"
          - name: event_json
            description: "Event data in JSON format"
          - name: transaction_digest
            description: "Transaction hash"
          - name: event_index
            description: "Event index within transaction"
          - name: timestamp_ms
            description: "Event timestamp in milliseconds"
          - name: sender
            description: "Event sender address"
          - name: package
            description: "Package address"
          - name: epoch
            description: "Sui epoch number"
          - name: checkpoint
            description: "Sui checkpoint number"

      - name: objects
        description: "Sui blockchain objects"
        columns:
          - name: object_id
            description: "Object identifier"
          - name: type_
            description: "Object type"
          - name: object_json
            description: "Object data in JSON format"
          - name: bcs
            description: "Binary Canonical Serialization data"
          - name: checkpoint
            description: "Sui checkpoint number"
          - name: version
            description: "Object version"
